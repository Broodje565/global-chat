(()=>{var te=localStorage.getItem("LOG")=="true";function c(e){te&&console.log(e)}function N(e,t){for(;e.firstChild;)e.firstChild.remove();e.appendChild(t)}function D(){return/Mobi|Android|iPad|iPhone|Tablet|Touch/i.test(navigator.userAgent)}var A=["smpp","smppoud","smpplite","gc","fire","404","arch","tux","ferris","gopher"];function U(e,t){let o=document.createElement("span");o.innerText=e,t.appendChild(o)}function oe(e,t){let o=document.createElement("span"),n=document.createElement("mark");n.classList.add("profanity-mark"),n.innerText=e,o.appendChild(n),t.appendChild(o)}function ne(e,t){let o;if(A.includes(e)){let n=document.createElement("img");if(n.width=50,n.dataset.sticker=e,n.src=ROOT_URL+"/static/stickies/"+e+".webp",e=="404"){let r=document.createElement("a");r.appendChild(n),r.classList.add("notfound"),r.href="https://www.youtube.com/watch?v=dQw4w9WgXcQ",o=r}else o=n}return o&&t.appendChild(o),o}function _(e,t,o){if(t)_(e.substring(0,t[0]),null,o),oe(e.substring(t[0],t[1]),o),_(e.substring(t[1],e.length),null,o);else{let n=/:[a-z0-9_-]{1,10}:/g,r=e.matchAll(n),i=0;for(let a of r){let g=!1;U(e.substring(i,a.index),o);let l=a[0].substring(1,a[0].length-1);A.includes(l)&&(ne(l,o),i=a.index+a[0].length)}U(e.substring(i),o)}}function G(){return BigInt(new Date().getTime()-17041104e5)<<22n}function j(e){return(e==null||e==null||e==0)&&console.error("invalid snowflake id: "+e),new Date(Number(e>>22n)+17041104e5).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"})}var ie=document.getElementById("message-template"),d=class{content;sender;snowflake;profanity;mod_badge;constructor(t,o,n=null){this.content=t,this.sender=o,n==null?this.snowflake=G():this.snowflake=n,this.profanity=!1,this.mod_badge=!1}};function C(e,t=!0,o=null){let r=ie.content.cloneNode(!0).querySelector(".message");e.profanity&&(r.classList.add("prof-message"),r.addEventListener("click",g=>{r.classList.contains("prof-message-show")?r.classList.remove("prof-message-show"):r.classList.add("prof-message-show")})),r.dataset.username=e.sender,r.dataset.snowflake=e.snowflake;let i=r.querySelector(".user");i.innerText=e.sender,e.mod_badge&&i.classList.add("mod-badge"),r.querySelector(".timestamp").innerText=j(e.snowflake);let a=r.querySelector(".delbtn");return a&&(t?a.addEventListener("click",()=>{s.deleteMessage(e.snowflake)}):a.remove()),_(e.content,o,r.querySelector(".content")),r}var le=4,ce=5,de=6,me=7,ue=8;var ge=33,H={err_cmd:"Je bent gekicked door een admin.",err_ratelimit:`Te veel berichten. Typ langzamer.
Je kunt terug joinen binnen een paar seconden`,err_ipratelimit:"Er zijn spammers met het zelfde ip als jou.",err_toomanyusers:"Er worden op dit moment te veel nieuwe gebruikers gemaakt. Dit komt waarschijnlijk door spammers.",err_505:"Stop and wait a sec when you look at me like that my darling what do you expect. In my imagination you're waiting lying on your side with your hands between your theights.",err_full:"De chat zit vol.",err_shutdown:"Globalchat gaat even offline. Sorry voor het ongemak",err_username_invalid:"Gebruikersnaam bevat ongeldige letters.",err_username_length:"Gebruikersnaam is te kort of te lang.",err_username_taken:"Gebruikersnaam is bezet.",err_username_prof:"Gebruikersnaam is ongepast"};function V(e){if(e=="err_ratelimit"&&Math.floor(Math.random*505)==1)return H.err_505;let t=H[e];return t||(t="Onverwachte fout."),t}var M=class{#e;#t;constructor(t){this.dv=t,this.index=0,this.tdecoder=new TextDecoder}getString(t,o){let n=typeof o=="number"?o:this.dv.byteLength-(this.index+t),r=new DataView(this.dv.buffer,this.index+t,n);return this.index+=n,this.tdecoder.decode(r)}getUint8(t=0){let o=this.dv.getUint8(this.index+t,!1);return this.index+=1,o}getUint16(t=0){let o=this.dv.getUint16(this.index+t,!1);return this.index+=2,o}getUint32(t=0){let o=this.dv.getUint32(this.index+t,!1);return this.index+=4,o}getSnowflake(t=0){let o=this.dv.getBigUint64(this.index+t,!1);return this.index+=8,o}getDate(t=0){return new Date(this.getUint32(t)*1e3*60)}end(){return this.index>=this.dv.byteLength}};function pe(e,t){if(e!==t){let o=localStorage.getItem("last_client_outdated_reload"),n=new Date().getTime();o==null||n-parseInt(o)>1e3?(localStorage.setItem("last_client_outdated_reload",n),console.log("NEW PROTOCOL VERSION. RELOADING PAGE TO UPDATE CLIENT"),location.reload()):(console.log("protocol_ver: "+e+" page_ver: "+t),console.error("Infinite reload loop detected"),alert("Alles is kapot aaaaaaaaaaaaa."))}}var y=class{on_message;on_message_del;on_message_sensor;on_profanity_warn;on_leave;on_join;on_keychange;#e;#t;#n;constructor(){this.users={}}#o(t,o){if(t>=0&&t<4){let n=t>>1&1,r=t&1,i=o.getUint16(0),a=o.getSnowflake(0),g=o.getString(0),l=this.users[i],p=new d(g,l,a);p.profanity=r,p.mod_badge=n,this.on_message(this.local_id==i,i,p);return}switch(t){case le:this.on_join();let n=o.getUint16(0);c("Protocol version: "+n+" My version: "+VERSION_INT),pe(n,VERSION_INT),this.local_id=o.getUint16(),this.users[this.local_id]=this.username,this.local_key=o.getString(0,ge),this.on_keychange(this.local_key),c("Setup packet "+this.local_id+" "+this.local_key);break;case ce:let r=o.getUint16(0),i=o.getString(0);c("user join: "+i+" ("+r+")"),this.users[r]=i;break;case de:let a=o.getUint16(0),g=o.getUint16(0),l=o.getUint16(0),p=o.getString(0,l),k=o.getString(0);this.on_profanity_warn(p,k,a,g);break;case me:let L=o.getSnowflake(0);this.on_message_del(L);break;case ue:let ee=o.getSnowflake(0);this.on_message_censor(ee);break;default:console.error("PROTOCOL_ERROR: Invalid subid ("+t+") packet recieved");break}}async join(t,o,n,r){this.user_wants_leave=!1,this.username=o,this.ws!==void 0&&await this.ws.close();let a=`username=${encodeURIComponent(o)}`;t!=null&&t!==""&&(a+="&key="+t),n!=null&&(a+="&start_time="+n),r&&(a+="&mod_badge=true");let g=WEBSOCKET_URL+"?"+a;c("creating socket: "+g),this.ws=new WebSocket(g),this.ws.binaryType="arraybuffer",this.ws.onclose=async l=>{this.users={},console.error("disconnect reason: "+l.reason),this.on_leave(l.code,l.reason,this.user_wants_leave)},this.ws.onmessage=async l=>{let p=l.data;if(p instanceof ArrayBuffer){let k=new M(new DataView(p)),L=k.getUint8();this.#o(L,k)}}}async deleteMessage(t){if(this.ws.readyState!==WebSocket.OPEN)return!1;await this.ws.send("%admin /delmsg "+t)}async send(t){return this.ws.readyState!==WebSocket.OPEN||this.ws.bufferedAmount>2?!1:(await this.ws.send(t),!0)}async leave(){this.user_wants_leave=!0,await this.ws.close(1e3,"Dag dag ik ga je missen. xxx")}};var K=document.getElementById("disclaimer"),m=document.getElementById("disclaimer-check"),W=document.getElementById("disclaimer-countdown"),he=document.getElementById("disclaimer-countdown-text"),h=15,O;localStorage.getItem("accepted_disclaimer")==K.dataset.disclaimerVer?($(),m.checked=!0):(m.disabled=!0,m.checked=!1,W.innerText=h+(h==1?" seconde":" seconden"),O=setInterval(()=>{h--,W.innerText=h+(h==1?" seconde":" seconden"),h<=0&&$()},1e3));function $(){O&&clearInterval(O),m.checked=!1,m.disabled=!1,he.innerText="Ga akkoord met de regels om op global chat te kunnen chatten."}m.addEventListener("change",e=>{e.target.checked?localStorage.setItem("accepted_disclaimer",K.dataset.disclaimerVer):localStorage.setItem("accepted_disclaimer",-1)});document.addEventListener("input",e=>{if(e.target.dataset.plaintext=="true"&&e.dataTransfer!==null){let t=e.target;for(let o=0;o<t.childNodes.length;o++){let n=t.childNodes[o];if(n.nodeName!=="#text"){let r=document.createTextNode(n.innerText);t.insertBefore(r,n),n.remove(),o--}}}});var v=document.getElementById("mesgs"),b=document.getElementById("send-input"),E=document.getElementById("name-input"),xe=document.getElementById("leavebtn"),ve=document.getElementById("sendbtn"),we=document.getElementById("show-mod-badge"),x=document.getElementById("connectbtn"),I=document.getElementById("connection-status"),ke=document.getElementById("err-mesg"),f=document.getElementById("login"),w=document.getElementById("profane-message-dialog"),_e=document.getElementById("profane-message"),S=document.getElementById("profane-message-ok"),q=document.getElementById("profane-message-countdown"),ye=document.getElementById("badword");m.addEventListener("change",e=>{x.disabled=!e.target.checked});x.disabled=!m.checked;var u=0,P,s=new y;function T(e,t=!1){let o=C(e,controls=!0,highlight=null),n=Math.abs(v.scrollHeight-v.clientHeight-v.scrollTop)<=3||t;v.appendChild(o),n&&o.scrollIntoView()}local_commands.push(["/clearkey",function(){return localStorage.removeItem("key"),T(new d("key cleared.","system")),!0}]);local_commands.push(["/leave",function(){return s.leave(),!0}]);var F=!1;s.on_join=()=>{I.close(),F=!1};var B=0,X=!1;function Ee(e){f.open||f.showModal(),X=!0;let t=x.disabled;x.disabled=!0,setTimeout(()=>{x.disabled=t,X=!1},e)}function Se(e){(e.includes("<script>")||e.includes("alert(1)")&&e.includes("<"))&&T(new d("I see the xss-er has joined. Vewie pwo hweker :3","system")),e.includes("SELECT")&&e.includes("FROM")&&e.includes("WHERE")&&T(new d("Sql injection? Why? Messages aren't even stored?","system"))}var z=null;s.on_message=(e,t,o)=>{z=o.snowflake,c(`Got message from ${t} (${o.snowflake}) mod: ${o.mod_badge}: ${o.content}`),T(o,scroll=e),e&&Se(o.content)};function J(e){return document.querySelector(`.message[data-snowflake="${e}"]`)}s.on_message_censor=e=>{let t=J(e);t&&t.classList.add("prof-message")};s.on_message_del=e=>{let t=J(e);t&&t.remove()};s.on_leave=(e,t,o)=>{if(c("disconnected "+e),I.close(),error=V(t),time=1e3,o||e==1e3)error="";else if(t=="err_ratelimit")time=5e3;else if(e==1006&&t==""){let n=Date.now();if(B==0||n-B>1e4){B=n,Z(!0,z);return}}ke.innerText=error,Ee(time),z=null,v.innerHTML="",f.showModal(),u=0,clearInterval(P),w.close()};s.on_keychange=e=>{localStorage.setItem("key",e)};s.on_profanity_warn=(e,t,o,n)=>{c(`${e} contains the word '${t}' at ${o}..${n}'`),u=10,P=setInterval(()=>{u--,q.innerText=u+(u==1?" seconde":" seconden"),u==0&&(clearInterval(P),S.innerText="Ok",S.disabled=!1)},1e3),q.innerText=u+u==1?"seconde":"seconden",S.disabled=!0,ye.innerText=t;let r=C(new d(e,Y()),controls=!1,highlight=[o,n]);N(_e,r),w.showModal()};async function Q(){let e=b.innerText.trim();if(e.length<MIN_MESSAGE_LEN||e.length>MAX_MESSAGE_LEN)return!1;for(let t of local_commands)if(e==t[0])return t[1]()?(b.innerText="",!0):!1;return await s.send(e)?(b.innerText="",!0):!1}function Y(){let e=E.value;return E.value==""&&(e=E.dataset.default_username),e}function Z(e,t){let o=we?.checked;c("connecting... in_background="+e+", mod_badge:"+o);let n=Y();localStorage.setItem("username",n),F=e,s.join(localStorage.getItem("key"),n,t,o),I.showModal()}b.addEventListener("keypress",e=>{e.key=="Enter"&&!e.shiftKey&&!D()&&(e.preventDefault(),Q())});ve.addEventListener("click",()=>{Q()&&setTimeout(()=>{b.focus()},100)});I.addEventListener("cancel",e=>{e.preventDefault()});xe.addEventListener("click",()=>{s.leave()});f.addEventListener("close",e=>{Z(!1)});f.addEventListener("cancel",e=>{e.preventDefault()});x.addEventListener("click",()=>{f.close(),b.focus()});w.addEventListener("close",()=>{u>0&&w.showModal()});S.addEventListener("click",()=>{w.close()});E.value=localStorage.getItem("username");f.showModal();})();
//# sourceMappingURL=v1.js.map
